<app-report-header [reportTitle]="reportTitle"
        [userName]="`${currentUser?.firstName} ${currentUser?.lastName}`"></app-report-header>
<div style="display: flex; justify-content: space-between; align-items: center;">
    <button
    [disabled]="!report"
    nz-button
    nzType="primary"
    (click)="downloadPdf()"
  >
    <i nz-icon nzType="download"></i>Download PDF
  </button>
    <nz-range-picker nzMode="month" [(ngModel)]="dateMonthsRange" (ngModelChange)="onMonthRangeChange($event)"></nz-range-picker>
    <nz-select [ngModel]="categoryFilterValue" style="min-width: 200px;"
    (ngModelChange)="onCategoryFilterChange($event)">
        <nz-option  [nzValue]="''" nzLabel="All"></nz-option>
        @for (category of listOfCategories; track $index) {
            <nz-option [nzValue]="category" [nzLabel]="category"></nz-option>
        } 
    </nz-select>
</div>

@for(monthlyReport of report?.monthlyReports; track $index){
<div class="month-year-date">
  {{ getFormattedMonthAndYear(monthlyReport.reportMonthAndYear) }}
</div>
<app-report-listing
  [listOfColumns]="listOfColumns"
  [tableData]="monthlyReport.reportRecords"
></app-report-listing>
}

@if(report){
    <div class="yearly-totals-section">
        <div>{{totalsTitle}}</div>
        <div class="totals-and-range-container">            
            <div class="months-range">
                {{getMonthRange}}
            </div>
        </div>
    </div>
}

<div *ngIf="reportType === 'outcome'">
    @for (total of report?.yearTotals; track $index) {
        <div>{{`${total.category} : ${total.percentage}%`}}</div>
    }
</div>

<div *ngIf="reportType === 'sepsis'">
  <h2>Sepsis Organism Summary</h2>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Organism</th>
        <th>Cases</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of sepsisOrganismTotals">
        <td>{{ row.organism }}</td>
        <td>{{ row.cases }}</td>
      </tr>
      <tr>
        <td colspan="2"><strong>Total Admissions:</strong> {{ sepsisSummary.totalAdmissions }}</td>
      </tr>
      <tr>
        <td colspan="2"><strong>Overall Sepsis Rate:</strong> {{ sepsisSummary.overallSepsisRate | number:'1.2-2' }}%</td>
      </tr>
    </tbody>
  </table>
</div>